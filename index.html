<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>弹幕demo</title>
</head>

<body>
    <div class="screen"></div>
    <div class="toolbar">
        <input id="text" type="text" placeholder="请输入弹幕内容" />
        <button class="send">发射</button>
        <button class="clear">关闭弹幕</button>
    </div>

    <script src="jquery-3.4.1.js"></script>
    <script>
        var isShow=true;
        function createScreenbullet(text) {
            let jqueryDom = $("<div class='dan_mu'>" + text + "</div>");
            //随机生成弹幕颜色
            let fontColor = "rgb(" + Math.floor(Math.random() * 256) + "," + Math.floor(Math.random() * 256) + "," + Math.floor(Math.random()) + ")";
            //随机生成弹幕大小
            let fontSize = Math.floor((Math.random() + 1) * 24) + "px";
            //获取弹幕区的宽度
            let left = $(".screen").width() + "px";
            //随机生成弹幕所在的高度
            let top = Math.floor(Math.random() * 300) + "px";
            //设置弹幕的样式参数
            jqueryDom.css({
                "position": 'absolute',
                "color": fontColor,
                "font-size": fontSize,
                "left": left,
                "top": top
            });
            //将弹幕div加入到弹幕区
            $(".screen").append(jqueryDom);
            //将新建的弹幕元素返回
            return jqueryDom;
        }

        function addInterval(jqueryDom) {
            //弹幕div所在位置减去屏幕左上角位置，得left参数：弹幕div离最左边的位置
            let left = jqueryDom.offset().left - $(".screen").offset().left;
            //随机生成弹幕移动速度
            let speed=Math.random()*20+3;
            let timer = setInterval(function () {
                left--;
                //设置弹幕div的left属性
                jqueryDom.css("left", left + "px");
                if (jqueryDom.offset().left + jqueryDom.width() < $(".screen").offset().left) {
                    //当弹幕div的位置在屏幕左边，remove
                    jqueryDom.remove();
                    clearInterval(timer);
                }
            }, speed);
        }

        $(".send").on("click", function () {
            // 创建弹幕
            let jqueryDom = createScreenbullet($("#text").val());
            // 添加定时任务
            addInterval(jqueryDom);
            //输入框置空
            $("#text").val('')
        });

        $("#text").on("keydown", function (event) {
            if (event.keyCode == 13) {
                // 创建弹幕
                var jqueryDom = createScreenbullet($("#text").val());
                // 添加定时器
                addInterval(jqueryDom);
                //输入框置空
                $("#text").val('')
            }
        });

        $(".clear").on("click", function () {
            if (isShow) {
                //设置弹幕透明度，使弹幕消失
                $(".dan_mu").css("opacity", 0);
                isShow = false;
                //修改button的内容
                this.innerHTML='打开弹幕'
            } else {
                //设置弹幕透明度，使弹幕出现
                $(".dan_mu").css("opacity", 1);
                isShow = true;
                //修改button的内容
                this.innerHTML='关闭弹幕'
            }
        });
    </script>
</body>
<style>
    .screen {
        position: relative;
        width: 100%;
        height: 400px;
        margin: 30px auto;
        overflow: hidden;
    }

    .toolbar {
        width: 600px;
        margin: 20px auto;
        text-align: center;
    }
</style>

</html>